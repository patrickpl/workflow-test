name: Signal Team Notifications

on:
  push:
    branches: [ "main", "master" ]
  issues:
    types: [opened, edited, labeled, unlabeled, assigned, unassigned, milestoned, demilestoned, closed, reopened]

jobs:
  signal-notify:
    runs-on: ubuntu-latest
    steps:
      - name: Prepare Notification Data
        id: prep
        shell: bash
        run: |
          REPO_URL="https://github.com/${{ github.repository }}"

          if [ "${{ github.event_name }}" = "push" ]; then
            COMMIT_SHA="${{ github.sha }}"
            SHORT_SHA="$(echo "$COMMIT_SHA" | cut -c1-7)"
            COMMIT_URL="$REPO_URL/commit/$COMMIT_SHA"

            echo "msg<<EOF" >> $GITHUB_OUTPUT
            echo "ðŸš€ New Commit!" >> $GITHUB_OUTPUT
            echo "" >> $GITHUB_OUTPUT
            echo "ðŸ‘¤ Who: ${{ github.actor }}" >> $GITHUB_OUTPUT
            echo "ðŸ“ What: ${{ github.event.head_commit.message }}" >> $GITHUB_OUTPUT
            echo "ðŸ”— Link: $COMMIT_URL ($SHORT_SHA)" >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT

          elif [ "${{ github.event_name }}" = "issues" ]; then
            ISSUE_URL="$REPO_URL/issues/${{ github.event.issue.number }}"

            if [ "${{ github.event.action }}" = "opened" ]; then
              echo "msg<<EOF" >> $GITHUB_OUTPUT
              echo "ðŸ†• New Issue!" >> $GITHUB_OUTPUT
              echo "" >> $GITHUB_OUTPUT
              echo "ðŸ“Œ Title: ${{ github.event.issue.title }}" >> $GITHUB_OUTPUT
              echo "ðŸ‘¤ Von: ${{ github.event.issue.user.login }}" >> $GITHUB_OUTPUT
              echo "ðŸ”— Link: $ISSUE_URL" >> $GITHUB_OUTPUT
              echo "EOF" >> $GITHUB_OUTPUT
            elif [ "${{ github.event.action }}" = "closed" ]; then
              echo "msg<<EOF" >> $GITHUB_OUTPUT
              echo "âœ… Issue Solved!" >> $GITHUB_OUTPUT
              echo "" >> $GITHUB_OUTPUT
              echo "ðŸ“Œ Title: ${{ github.event.issue.title }}" >> $GITHUB_OUTPUT
              echo "ðŸ‘¤ Solved by: ${{ github.event.sender.login }}" >> $GITHUB_OUTPUT
              echo "ðŸ”— Link: $ISSUE_URL" >> $GITHUB_OUTPUT
              echo "EOF" >> $GITHUB_OUTPUT
            else
              echo "msg<<EOF" >> $GITHUB_OUTPUT
              echo "ðŸ”„ Issue Updated!" >> $GITHUB_OUTPUT
              echo "" >> $GITHUB_OUTPUT
              echo "ðŸ“Œ Title: ${{ github.event.issue.title }}" >> $GITHUB_OUTPUT
              echo "ðŸ”§ Action: ${{ github.event.action }}" >> $GITHUB_OUTPUT
              echo "ðŸ‘¤ Updated by: ${{ github.event.sender.login }}" >> $GITHUB_OUTPUT
              echo "ðŸ”— Link: $ISSUE_URL" >> $GITHUB_OUTPUT
              echo "EOF" >> $GITHUB_OUTPUT
            fi
          else
            echo "${{ github.event_name }}"
          fi
